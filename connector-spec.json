{
    "name": "Attribute Generator",
    "description": "Attribute Generator is a connector that generates attributes based on a given expression.",
    "commands": [
        "std:test-connection",
        "std:account:list",
        "std:account:read",
        "std:account:create",
        "std:account:update",
        "std:entitlement:list",
        "std:account:discover-schema"
    ],
    "supportsCustomSchemas": false,
    "supportsStatefulCommands": true,
    "showDebugLoggingOption": true,
    "sourceConfigInitialValues": {
        "search": "*",
        "digits": 1,
        "counterStart": 1,
        "case": "same",
        "expression": "#set($initial = $firstname.substring(0, 1))$initial$lastname",
        "unique": false,
        "refresh": false,
        "force": false,
        "type": "normal",
        "spConnEnableStatefulCommands": true
    },
    "sourceConfig": [
        {
            "type": "menu",
            "label": "Connection Details",
            "items": [
                {
                    "type": "section",
                    "sectionTitle": "Identity Security Cloud connection configuration",
                    "sectionHelpMessage": "<strong>Configure your Identity Security Cloud tenant connection.</strong><br><br>Use <strong>Identity Security Cloud API URL</strong> for the base URL of your tenant (for example, https://example.api.identity.security.cloud).<br><br>Use <strong>Personal Access Token ID</strong> for the client ID of a Personal Access Token with the required API permissions.<br><br>Use <strong>Personal Access Token secret</strong> for the corresponding client secret. Keep this value secure.",
                    "items": [
                        {
                            "key": "baseurl",
                            "label": "Identity Security Cloud API URL",
                            "type": "url",
                            "required": true
                        },
                        {
                            "key": "clientId",
                            "label": "Personal Access Token ID",
                            "type": "text",
                            "required": true
                        },
                        {
                            "key": "clientSecret",
                            "label": "Personal Access Token secret",
                            "type": "secret",
                            "required": true
                        }
                    ]
                }
            ]
        },
        {
            "type": "menu",
            "label": "Attributes",
            "items": [
                {
                    "type": "section",
                    "sectionTitle": "Attribute Generation Configuration",
                    "sectionHelpMessage": "<strong>Define how account attributes are generated.</strong><br><br>Toggle <strong>Use search for aggregation?</strong> to build attributes using results from an Identity search.<br><br>When search is enabled, enter an <strong>Identity Search Query</strong> to select which identities to use for aggregation.<br><br>Use <strong>Attribute Generation Definitions</strong> to add cards, each describing how a single attribute is built (name, expression, case, type, counters, normalization, and refresh behavior).<br><br>Toggle <strong>Support for incremental counters</strong> to allow stateful commands so counter-based attributes can increment across runs.",
                    "items": [
                        {
                            "key": "useSearch",
                            "label": "Use search for aggregation?",
                            "type": "toggle",
                            "required": false
                        },
                        {
                            "key": "search",
                            "label": "Identity Search Query",
                            "type": "text",
                            "required": true,
                            "parentKey": "useSearch",
                            "parentValue": "true"
                        },
                        {
                            "key": "attributes",
                            "label": "Attribute Generation Definitions",
                            "titleKey": "query",
                            "subtitleKey": "name",
                            "dragNDropEnabled": true,
                            "deleteButton": true,
                            "editButton": true,
                            "addButton": true,
                            "copyButton": true,
                            "buttonLabel": "New Account Attribute Definition",
                            "type": "cardList",
                            "helpKey": "Add definitions to build your attributes",
                            "subMenus": [
                                {
                                    "label": "Attribute Configuration",
                                    "items": [
                                        {
                                            "key": "name",
                                            "label": "Attribute Name",
                                            "type": "text",
                                            "required": true
                                        },
                                        {
                                            "key": "expression",
                                            "label": "Apache Velocity expression",
                                            "type": "textarea",
                                            "required": true
                                        },
                                        {
                                            "key": "case",
                                            "label": "Case selection",
                                            "type": "select",
                                            "required": true,
                                            "options": [
                                                {
                                                    "label": "Do not change",
                                                    "value": "same"
                                                },
                                                {
                                                    "label": "Lower case",
                                                    "value": "lower"
                                                },
                                                {
                                                    "label": "Upper case",
                                                    "value": "upper"
                                                },
                                                {
                                                    "label": "Capitalize",
                                                    "value": "capitalize"
                                                }
                                            ]
                                        },
                                        {
                                            "key": "type",
                                            "label": "Attribute Type",
                                            "type": "select",
                                            "required": true,
                                            "options": [
                                                {
                                                    "label": "Normal",
                                                    "value": "normal"
                                                },
                                                {
                                                    "label": "Unique",
                                                    "value": "unique"
                                                },
                                                {
                                                    "label": "Counter-based",
                                                    "value": "counter"
                                                }
                                            ]
                                        },
                                        {
                                            "key": "counterStart",
                                            "label": "Counter start value",
                                            "type": "number",
                                            "required": true,
                                            "parentKey": "type",
                                            "parentValue": "counter"
                                        },
                                        {
                                            "key": "digits",
                                            "label": "Minimum counter digits ($counter)",
                                            "type": "number",
                                            "required": true,
                                            "parentKey": "type",
                                            "parentValue": "counter"
                                        },
                                        {
                                            "key": "normalize",
                                            "label": "Normalize special characters?",
                                            "type": "toggle"
                                        },
                                        {
                                            "key": "spaces",
                                            "label": "Remove spaces?",
                                            "type": "toggle"
                                        },
                                        {
                                            "key": "refresh",
                                            "label": "Refresh on each aggregation? (when used with counter-based or unique attributes, this will reset the counter)",
                                            "type": "toggle"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "key": "spConnEnableStatefulCommands",
                            "label": "Support for incremental counters",
                            "required": true,
                            "type": "toggle"
                        }
                    ]
                }
            ]
        }
    ],
    "accountSchema": {
        "identityAttribute": "id",
        "displayAttribute": "name",
        "groupAttribute": "actions",
        "attributes": [
            {
                "name": "id",
                "type": "string",
                "description": "Account ID"
            },
            {
                "name": "name",
                "type": "string",
                "description": "Account name"
            },
            {
                "name": "actions",
                "type": "string",
                "description": "Actions",
                "entitlement": true,
                "managed": true,
                "multiple": false,
                "schemaObjectType": "action"
            }
        ]
    },
    "entitlementSchemas": [
        {
            "type": "action",
            "identityAttribute": "id",
            "displayAttribute": "name",
            "attributes": [
                {
                    "name": "id",
                    "type": "string",
                    "description": "ID"
                },
                {
                    "name": "name",
                    "type": "string",
                    "description": "Name"
                },
                {
                    "name": "description",
                    "type": "string",
                    "description": "Description"
                }
            ]
        }
    ],
    "accountCreateTemplate": {
        "fields": [
            {
                "key": "name",
                "label": "Name",
                "type": "string",
                "required": true,
                "initialValue": {
                    "type": "static",
                    "attributes": {
                        "value": "$identity.getName()"
                    }
                }
            }
        ]
    }
}
