{
    "name": "Attribute Generator",
    "description": "Attribute Generator is a connector that generates attributes based on a given expression.",
    "commands": [
        "std:test-connection",
        "std:account:list",
        "std:account:read",
        "std:account:create",
        "std:account:update",
        "std:account:disable",
        "std:account:enable",
        "std:entitlement:list",
        "std:account:discover-schema"
    ],
    "supportsCustomSchemas": false,
    "supportsStatefulCommands": true,
    "showDebugLoggingOption": true,
    "sourceConfigInitialValues": {
        "search": "*",
        "digits": 1,
        "counterStart": 1,
        "case": "same",
        "expression": "#set($initial = $firstname.substring(0, 1))$initial$lastname",
        "unique": false,
        "refresh": false,
        "force": false,
        "type": "normal",
        "spConnEnableStatefulCommands": true,
        "keepManuallyGenerated": true
    },
    "sourceConfig": [
        {
            "type": "menu",
            "label": "Connection Configuration",
            "items": [
                {
                    "type": "section",
                    "sectionTitle": "Identity Security Cloud connection configuration",
                    "sectionHelpMessage": "<strong>Configure your Identity Security Cloud tenant connection.</strong><br><br>Use <strong>Identity Security Cloud API URL</strong> for the base URL of your tenant (for example, https://example.api.identity.security.cloud).<br><br>Use <strong>Personal Access Token ID</strong> for the client ID of a Personal Access Token with the required API permissions.<br><br>Use <strong>Personal Access Token secret</strong> for the corresponding client secret. Keep this value secure.",
                    "items": [
                        {
                            "key": "baseurl",
                            "label": "Identity Security Cloud API URL",
                            "type": "url",
                            "required": true
                        },
                        {
                            "key": "clientId",
                            "label": "Personal Access Token ID",
                            "type": "text",
                            "required": true
                        },
                        {
                            "key": "clientSecret",
                            "label": "Personal Access Token secret",
                            "type": "secret",
                            "required": true
                        }
                    ]
                }
            ]
        },
        {
            "type": "menu",
            "label": "Attribute Configuration",
            "items": [
                {
                    "type": "section",
                    "sectionTitle": "Attribute Generation Settings",
                    "sectionHelpMessage": "<strong>Define how account attributes are generated.</strong><br><br>Use <strong>Use search for aggregation?</strong> to optionally build attributes using results from an Identity search instead of only this source's accounts.<br><br>When search is enabled, enter an <strong>Identity Search Query</strong>. If <strong>Keep manually generated accounts outside the search query</strong> is enabled, accounts that were manually generated from this source are always included in aggregation even if they do not match the search query.<br><br>Use <strong>Attribute Generation Definitions</strong> to configure how each attribute is built (name, Apache Velocity expression, case, type, counter start, minimum counter digits, maximum length, normalization, spacing, and refresh behavior). <strong>Apache Velocity expressions</strong> have access to an enhanced context including <strong>Math</strong> (JavaScript Math object for mathematical operations), <strong>Date</strong> (JavaScript Date object for date manipulation), and <strong>Datefns</strong> (date-fns library for advanced date formatting and manipulation). <strong>Maximum length</strong> truncates generated values to the specified length (for unique and counter attributes, the counter is preserved at the end). <strong>Refresh on each aggregation?</strong> is only available for normal attributes and causes the attribute to be recalculated every aggregation run, even if it already has a value on the account. Counter-based and unique attributes always preserve their state across runs. <strong>UUID attributes</strong> generate universally unique identifiers automatically.<br><br>The connector supports disabling and enabling accounts. When an account is enabled, all attributes (including unique attributes) are force refreshed and recalculated, ensuring that unique attribute values are regenerated based on the current state of all accounts.<br><br>Toggle <strong>Support for incremental counters</strong> to enable stateful commands required for counter-based attributes to increment across connector runs.",
                    "items": [
                        {
                            "key": "useSearch",
                            "label": "Use search for aggregation?",
                            "type": "toggle",
                            "required": false
                        },
                        {
                            "key": "keepManuallyGenerated",
                            "label": "Keep manually generated accounts outside the search query",
                            "type": "toggle",
                            "required": false,
                            "parentKey": "useSearch",
                            "parentValue": "true"
                        },
                        {
                            "key": "search",
                            "label": "Identity Search Query",
                            "type": "text",
                            "required": true,
                            "parentKey": "useSearch",
                            "parentValue": "true"
                        },
                        {
                            "key": "attributes",
                            "label": "Attribute Generation Definitions",
                            "titleKey": "query",
                            "subtitleKey": "name",
                            "dragNDropEnabled": true,
                            "deleteButton": true,
                            "editButton": true,
                            "addButton": true,
                            "copyButton": true,
                            "buttonLabel": "New Account Attribute Definition",
                            "type": "cardList",
                            "helpKey": "Add definitions to build your attributes",
                            "subMenus": [
                                {
                                    "label": "Attribute Configuration",
                                    "items": [
                                        {
                                            "key": "name",
                                            "label": "Attribute Name",
                                            "type": "text",
                                            "required": true
                                        },
                                        {
                                            "key": "expression",
                                            "label": "Apache Velocity expression",
                                            "type": "textarea",
                                            "required": false
                                        },
                                        {
                                            "key": "case",
                                            "label": "Case selection",
                                            "type": "select",
                                            "required": true,
                                            "options": [
                                                {
                                                    "label": "Do not change",
                                                    "value": "same"
                                                },
                                                {
                                                    "label": "Lower case",
                                                    "value": "lower"
                                                },
                                                {
                                                    "label": "Upper case",
                                                    "value": "upper"
                                                },
                                                {
                                                    "label": "Capitalize",
                                                    "value": "capitalize"
                                                }
                                            ]
                                        },
                                        {
                                            "key": "type",
                                            "label": "Attribute Type",
                                            "type": "select",
                                            "required": true,
                                            "options": [
                                                {
                                                    "label": "Normal",
                                                    "value": "normal"
                                                },
                                                {
                                                    "label": "Unique",
                                                    "value": "unique"
                                                },
                                                {
                                                    "label": "UUID",
                                                    "value": "uuid"
                                                },
                                                {
                                                    "label": "Counter-based",
                                                    "value": "counter"
                                                }
                                            ]
                                        },
                                        {
                                            "key": "counterStart",
                                            "label": "Counter start value",
                                            "type": "number",
                                            "required": true,
                                            "parentKey": "type",
                                            "parentValue": "counter"
                                        },
                                        {
                                            "key": "digits",
                                            "label": "Minimum counter digits ($counter)",
                                            "type": "number",
                                            "required": true,
                                            "parentKey": "type",
                                            "parentValue": "counter"
                                        },
                                        {
                                            "key": "maxLength",
                                            "label": "Maximum length",
                                            "type": "number",
                                            "required": false,
                                            "min": "1"
                                        },
                                        {
                                            "key": "normalize",
                                            "label": "Normalize special characters?",
                                            "type": "toggle"
                                        },
                                        {
                                            "key": "spaces",
                                            "label": "Remove spaces?",
                                            "type": "toggle"
                                        },
                                        {
                                            "key": "refresh",
                                            "label": "Refresh on each aggregation?",
                                            "type": "toggle",
                                            "parentKey": "type",
                                            "parentValue": "normal"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "key": "spConnEnableStatefulCommands",
                            "label": "Support for incremental counters",
                            "required": true,
                            "type": "toggle"
                        }
                    ]
                }
            ]
        }
    ],
    "accountSchema": {
        "identityAttribute": "id",
        "displayAttribute": "name",
        "groupAttribute": "actions",
        "attributes": [
            {
                "name": "id",
                "type": "string",
                "description": "Account ID"
            },
            {
                "name": "name",
                "type": "string",
                "description": "Account name"
            },
            {
                "name": "actions",
                "type": "string",
                "description": "Actions",
                "entitlement": true,
                "managed": true,
                "multiple": true,
                "schemaObjectType": "action"
            }
        ]
    },
    "entitlementSchemas": [
        {
            "type": "action",
            "identityAttribute": "id",
            "displayAttribute": "name",
            "attributes": [
                {
                    "name": "id",
                    "type": "string",
                    "description": "ID"
                },
                {
                    "name": "name",
                    "type": "string",
                    "description": "Name"
                },
                {
                    "name": "description",
                    "type": "string",
                    "description": "Description"
                }
            ]
        }
    ],
    "accountCreateTemplate": {
        "fields": [
            {
                "key": "name",
                "label": "Name",
                "type": "string",
                "required": true,
                "initialValue": {
                    "type": "static",
                    "attributes": {
                        "value": "$identity.getName()"
                    }
                }
            }
        ]
    }
}
